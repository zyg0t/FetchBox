<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üîê FetchBox</title>
  <style>
    button { margin: 10px; padding: 10px; font-size: 16px; }
    #downloadLink { display: none; margin-top: 20px; }
    #loading { display: none; font-size: 16px; color: #ff7f00; }
    #commitInfo { margin-top: 20px; font-size: 14px; color: #555; }
  </style>
</head>
<body>

  <div>
    <button data-action="tricky">Tricky Addon</button>
    <button data-action="yurikey">Yurikey</button>
    <button data-action="integrity">Integrity Box</button>
  </div>

  <div id="loading">Processing...</div>
  <a id="downloadLink" href="" download>Download</a>
  <div id="commitInfo"></div>

  <script>
    /* -----------------------------
       Generic helpers
    ------------------------------*/

    const loadingEl = document.getElementById('loading');
    const downloadLink = document.getElementById('downloadLink');
    const commitInfoEl = document.getElementById('commitInfo');

    const showLoading = (state) => loadingEl.style.display = state ? 'inline' : 'none';

    function hexToString(hex) {
      let out = '';
      for (let i = 0; i < hex.length; i += 2) {
        out += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
      }
      return out;
    }

    function rot13(str) {
      return str.replace(/[a-zA-Z]/g, c => {
        const base = c <= 'Z' ? 65 : 97;
        return String.fromCharCode(((c.charCodeAt(0) - base + 13) % 26) + base);
      });
    }

    function downloadXML(filename, data) {
      const xml = `<xml><data>${data}</data></xml>`;
      const blob = new Blob([xml], { type: 'application/xml' });
      downloadLink.href = URL.createObjectURL(blob);
      downloadLink.download = filename;
      downloadLink.textContent = `Download ${filename}`;
      downloadLink.style.display = 'inline';
    }

    async function fetchCommitInfo(repo, path) {
      const url = `https://api.github.com/repos/${repo}/commits?path=${path}&per_page=1`;
      const res = await fetch(url);
      const data = await res.json();
      const commitDate = new Date(data[0].commit.committer.date);
      const diff = Date.now() - commitDate.getTime();
      return formatTimeAgo(diff);
    }

    function formatTimeAgo(ms) {
      const s = Math.floor(ms / 1000);
      const m = Math.floor(s / 60);
      const h = Math.floor(m / 60);
      const d = Math.floor(h / 24);
      if (s < 60) return `${s} seconds ago`;
      if (m < 60) return `${m} minutes ago`;
      if (h < 24) return `${h} hours ago`;
      return `${d} days ago`;
    }

    /* -----------------------------
       Decryption pipelines
    ------------------------------*/

    function decodeTricky(hexData) {
      return atob(hexToString(hexData));
    }

    function decodeYurikey(base64Data) {
      return atob(base64Data);
    }

    function decodeIntegrityBox(input) {
      // 10x Base64 decode
      let data = input.trim();
      for (let i = 0; i < 10; i++) {
        data = atob(data);
      }
      // From_Hex('Auto')
      data = hexToString(data);
      // ROT13(true,true,false,13)
      return rot13(data);
    }

    /* -----------------------------
       Button actions
    ------------------------------*/

    document.addEventListener('click', async (e) => {
      if (!e.target.dataset.action) return;

      showLoading(true);
      commitInfoEl.textContent = '';
      downloadLink.style.display = 'none';

      try {
        switch (e.target.dataset.action) {
          case 'tricky': {
            const raw = await fetch('https://raw.githubusercontent.com/KOWX712/Tricky-Addon-Update-Target-List/refs/heads/main/.extra').then(r => r.text());
            const decoded = decodeTricky(raw);
            const timeAgo = await fetchCommitInfo('KOWX712/Tricky-Addon-Update-Target-List', '.extra');
            commitInfoEl.textContent = `Tricky Addon last commit: ${timeAgo}`;
            downloadXML('trickyaddon.xml', decoded);
            break;
          }

          case 'yurikey': {
            const raw = await fetch('https://raw.githubusercontent.com/YurikeyDev/yurikey/refs/heads/main/key').then(r => r.text());
            const decoded = decodeYurikey(raw);
            const timeAgo = await fetchCommitInfo('YurikeyDev/yurikey', 'key');
            commitInfoEl.textContent = `Yurikey last commit: ${timeAgo}`;
            downloadXML('yurikey.xml', decoded);
            break;
          }

          case 'integrity': {
            const raw = await fetch('https://raw.githubusercontent.com/MeowDump/MeowDump/refs/heads/main/NullVoid/ShockWave.tar').then(r => r.text());
            const decoded = decodeIntegrityBox(raw);
            const timeAgo = await fetchCommitInfo('MeowDump/MeowDump', 'NullVoid/ShockWave.tar');
            commitInfoEl.textContent = `Integrity Box last commit: ${timeAgo}`;
            downloadXML('integritybox.xml', decoded);
            break;
          }
        }
      } catch (err) {
        console.error(err);
        alert('Error processing request. Check console for details.');
      } finally {
        showLoading(false);
      }
    });
  </script>

</body>
</html>
