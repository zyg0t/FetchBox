<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ” FetchBox</title>
<style>
  button { margin:10px; padding:10px; font-size:16px }
  #downloadLink, #loading { display:none }
  #loading { color:#ff7f00 }
  #commitInfo { margin-top:20px; font-size:14px; color:#555 }
</style>
</head>
<body>

<div>
  <button data-action="tricky">Tricky Addon ğŸ”‘</button>
  <button data-action="yurikey">Yurikey ğŸ”‘</button>
  <button data-action="integrity">Integrity Box ğŸ”‘</button>
  <button data-action="verify">Commits âŒš</button>
</div>

<div id="loading">Processing...</div>
<a id="downloadLink" href="" download>Download</a>
<div id="commitInfo"></div>

<script>
const loadingEl = document.getElementById('loading'),
      downloadLink = document.getElementById('downloadLink'),
      commitInfoEl = document.getElementById('commitInfo');

const showLoading = state => loadingEl.style.display = state ? 'inline' : 'none';
const hexToString = hex => [...hex.match(/../g)].map(b=>String.fromCharCode(parseInt(b,16))).join('');
const rot13 = str => str.replace(/[a-z]/gi,c=>String.fromCharCode((c<='Z'?65:97)+((c.charCodeAt(0)-(c<='Z'?65:97)+13)%26)));
const downloadXML = (name,data)=>{const b=new Blob([`<xml><data>${data}</data></xml>`],{type:'application/xml'});downloadLink.href=URL.createObjectURL(b);downloadLink.download=name;downloadLink.textContent=`Download ${name}`;downloadLink.style.display='inline'};
const formatTimeAgo=ms=>{const s=Math.floor(ms/1000),m=Math.floor(s/60),h=Math.floor(m/60),d=Math.floor(h/24);return s<60?`${s}s ago`:m<60?`${m}m ago`:h<24?`${h}h ago`:`${d}d ago`};

async function safeFetch(url){
  try{const r=await fetch(url);if(r.status===403)return{status:'rate-limited'};if(!r.ok)return{status:'error'};const d=await r.json();return Array.isArray(d)&&d[0]?.commit?{status:'ok',commit:d[0].commit}:{status:'no-data'}}catch{return{status:'error'}}
}

async function fetchCommit(repo,path){const r=await safeFetch(`https://api.github.com/repos/${repo}/commits?path=${path}&per_page=1`);return r.status==='ok'?formatTimeAgo(Date.now()-new Date(r.commit.committer.date).getTime()):r.status==='rate-limited'?'Rate limited':'Commit info unavailable'}
async function fetchLatest(repo,path,label){const r=await safeFetch(`https://api.github.com/repos/${repo}/commits?path=${path}&per_page=1`);return r.status==='ok'?{label,date:new Date(r.commit.committer.date),timeAgo:formatTimeAgo(Date.now()-new Date(r.commit.committer.date).getTime())}:{label,date:new Date(0),timeAgo:r.status==='rate-limited'?'Rate limited':'Commit info unavailable'}}

const decoders = {
  tricky: h => atob(hexToString(h)),
  yurikey: h => atob(h),
  integrity: h => {
    let data = h.trim();
    for (let i=0; i<10; i++) data = atob(data);
    return rot13(hexToString(data));
  }
};

const files={
  tricky:{url:'https://raw.githubusercontent.com/KOWX712/Tricky-Addon-Update-Target-List/refs/heads/main/.extra',repo:'KOWX712/Tricky-Addon-Update-Target-List',path:'.extra',name:'trickyaddon.xml'},
  yurikey:{url:'https://raw.githubusercontent.com/YurikeyDev/yurikey/refs/heads/main/key',repo:'YurikeyDev/yurikey',path:'key',name:'yurikey.xml'},
  integrity:{url:'https://raw.githubusercontent.com/MeowDump/MeowDump/refs/heads/main/NullVoid/ShockWave.tar',repo:'MeowDump/MeowDump',path:'NullVoid/ShockWave.tar',name:'integritybox.xml'}
};

document.addEventListener('click',async e=>{
  const action=e.target.dataset.action; if(!action) return;
  showLoading(true); commitInfoEl.innerHTML=''; downloadLink.style.display='none';
  try{
    if(action==='verify'){
      const commits=await Promise.all(Object.entries(files).map(([k,v])=>fetchLatest(v.repo,v.path,k==='tricky'?'Tricky Addon':k==='yurikey'?'Yurikey':'Integrity Box')));
      commits.sort((a,b)=>b.date-a.date);
      commitInfoEl.innerHTML=`<strong>Latest commits:</strong><br><br>${commits.map(c=>`â€¢ <strong>${c.label}</strong> ~ ${c.timeAgo}`).join('<br>')}`;
    } else {
      const f=files[action];
      const raw=await fetch(f.url).then(r=>r.text());
      const decoded=decoders[action](raw);
      const timeAgo=await fetchCommit(f.repo,f.path);
      commitInfoEl.textContent=`${action==='tricky'?'Tricky Addon':action==='yurikey'?'Yurikey':'Integrity Box'} last commit: ${timeAgo}`;
      downloadXML(f.name,decoded);
    }
  } catch(err){console.error(err);alert('Error processing request.');}
  finally{showLoading(false);}
});
</script>

</body>
</html>
