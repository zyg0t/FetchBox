<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üîê FetchBox</title>

<style>
:root{--accent:#58a6ff;--bg1:#161b22;--bg2:#010409;--text:#e6e6e6;--muted:#8b949e}
*{-webkit-tap-highlight-color:transparent;box-sizing:border-box}
html,body{
  height:100%;margin:0;overflow:hidden;touch-action:none;
  font-family:Inter,Roboto,"Helvetica Neue",sans-serif;
  background:radial-gradient(circle,var(--bg1),var(--bg2));
  color:var(--text);color-scheme:dark;-webkit-font-smoothing:antialiased
}
body{display:grid;place-content:center;text-align:center}

button{
  margin:8px;padding:12px 24px;font-size:15px;font-weight:600;
  color:#fff;background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  border-radius:12px;cursor:pointer;transition:.2s;outline:none
}
button:hover{background:rgba(255,255,255,.1);border-color:var(--accent);transform:translateY(-2px)}
button:active{transform:scale(.96)}

.output-container{min-height:160px;margin-top:40px;display:flex;flex-direction:column;align-items:center}
#loading{color:var(--accent);font-style:italic;animation:pulse 1.5s infinite}
@keyframes pulse{50%{opacity:.5}}

#downloadLink{
  color:var(--accent);font-weight:700;text-decoration:none;
  border:1px solid var(--accent);padding:8px 16px;border-radius:8px
}
#downloadLink:hover{background:rgba(88,166,255,.1)}

#commitInfo{
  color:var(--muted);line-height:1.8;font-size:.85em;
  font-family:"JetBrains Mono","Roboto Mono",monospace
}

#modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.8);backdrop-filter:blur(8px);
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:.3s;z-index:100
}
#modal.open{opacity:1;pointer-events:all}
.modal-content{
  background:var(--bg1);width:90%;max-width:500px;max-height:80vh;
  border:1px solid rgba(255,255,255,.1);border-radius:20px;
  padding:24px;overflow-y:auto;text-align:left;font-size:14px;
  box-shadow:0 20px 50px rgba(0,0,0,.5)
}
.modal-content h2{font-size:18px;margin:20px 0 10px;color:var(--accent)}
.modal-content code{background:rgba(255,255,255,.1);padding:2px 4px;border-radius:4px}
table{width:100%;border-collapse:collapse;margin:10px 0;font-size:12px}
th,td{border:1px solid rgba(255,255,255,.1);padding:8px}
tr:nth-child(even){background:rgba(255,255,255,.03)}

.help-btn{display:block;width:200px;margin:-30px auto 30px;background:var(--accent);color:#000;border:none;font-weight:700;opacity:1}
.help-btn:hover{background:#79b8ff;transform:translateY(-2px)}

.hidden{display:none}
strong{color:#fff}
.err-msg{color:#ff7b72!important}
a{color:var(--accent);text-decoration:none}
</style>

</head>
<body>

<header style="margin-bottom:30px">
  <h1 style="margin:0;font-size:32px;font-weight:800;letter-spacing:-1.5px">
    Fetch<span style="color:var(--accent)">Box</span>
  </h1>
  <p style="color:var(--muted);font-size:14px">Device attestation made easy</p>
</header>

<div id="actions">
  <button data-action="tricky">Tricky Addon</button>
  <button data-action="yurikey">Yurikey</button>
  <button data-action="integrity">Integrity Box</button>
  <button data-action="verify">View Commits</button>
</div>

<div class="output-container">
  <div id="loading" class="hidden">Accessing repository...</div>
  <a id="downloadLink" class="hidden"></a>
  <div id="commitInfo" class="hidden"></div>
</div>

<button class="help-btn" onclick="$('modal').classList.add('open')">Setup Guide</button>
<div id="modal" onclick="this.classList.remove('open')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <h2 style="margin-top:0">Add custom keybox.xml file</h2>
    <ol style="padding-left:20px">
      <li>You must have the <a href="https://github.com/beakthoven/TrickyStoreOSS">Tricky Store</a> and <a href="https://github.com/KOWX712/Tricky-Addon-Update-Target-List">Tricky Store Addon</a> modules installed.</li>
      <li>Tap the <strong>Action</strong> button on Tricky Store to open the WebUI.</li>
      <li>Tap the <strong>hamburger menu</strong> in the top right corner.</li>
      <li>Select <strong>"Select All"</strong>, then <strong>"Deselect Unnecessary"</strong>.</li>
      <li>Press <strong>Save</strong> at the bottom.</li>
      <li>In the Addon menu, select <strong>Set Custom Keybox</strong>.</li>
      <li>Navigate to your <code>keybox.xml</code> file and select it.</li>
    </ol>

    <h2>Align Security Patch Date</h2>
    <p style="font-size:13px;color:var(--muted)">To prevent Google from seeing a mismatch between your system and the keybox:</p>
    <ol style="padding-left:20px">
      <li>In the menu, select <strong>"Set Security Patch"</strong>.</li>
      <li>Tap <strong>Get Security Patch Date</strong> (or <strong>"Auto"</strong>).</li>
      <li>Press <strong>Save</strong>.</li>
    </ol>

    <h2>Strong Integrity</h2>
    <p style="font-size:13px">To achieve strong integrity, pair with these extra modules (subject to change):</p>
    <ul style="padding-left:20px;line-height:1.5;font-size:13px">
      <li><strong>Kernel:</strong> KernelSU Next + SUSFS Patched Kernel</li>
      <li><strong>Modules:</strong> ReZygisk, susfs4ksu, Play Integrity Fix [INJECT], Tricky Store OSS, Tricky Store Addon</li>
    </ul>

    <button style="display:block;width:100%;margin:20px 0 0;background:var(--accent);color:#000" onclick="$('modal').classList.remove('open')">Dismiss</button>
  </div>
</div>

<script>
const $=id=>document.getElementById(id),
[load,dl,info]=['loading','downloadLink','commitInfo'].map($),
ui=(l,d,i,e=0)=>{
  load.classList.toggle('hidden',!l);
  dl.classList.toggle('hidden',!d);
  info.classList.toggle('hidden',!i);
  info.classList.toggle('err-msg',e);
},
hex=h=>h.match(/../g).map(b=>String.fromCharCode(parseInt(b,16))).join(''),
rot=s=>s.replace(/[a-z]/gi,c=>String.fromCharCode(
  (c<='Z'?65:97)+(c.charCodeAt(0)-(c<='Z'?65:97)+13)%26)),
ago=ms=>{
  const t=[[60,'s'],[60,'m'],[24,'h']],u=['s','m','h','d'];
  let i=0,v=ms/1000;while(i<3&&v>=t[i][0])v/=t[i++][0];
  return Math.floor(v)+u[i]+' ago';
};

const decoders={
  tricky:h=>atob(hex(h)),
  yurikey:h=>atob(h),
  integrity:h=>{
    let d=h.trim();for(let i=0;i<10;i++)d=atob(d);
    return rot(hex(d));
  }
};

const files={
  tricky:{r:'KOWX712/Tricky-Addon-Update-Target-List',p:'.extra',n:'trickyaddon.xml',l:'Tricky Addon',
    u:'https://raw.githubusercontent.com/KOWX712/Tricky-Addon-Update-Target-List/refs/heads/main/.extra'},
  yurikey:{r:'YurikeyDev/yurikey',p:'key',n:'yurikey.xml',l:'Yurikey',
    u:'https://raw.githubusercontent.com/YurikeyDev/yurikey/refs/heads/main/key'},
  integrity:{r:'MeowDump/MeowDump',p:'NullVoid/ShockWave.tar',n:'integritybox.xml',l:'Integrity Box',
    u:'https://raw.githubusercontent.com/MeowDump/MeowDump/refs/heads/main/NullVoid/ShockWave.tar'}
};

const getGit=async(r,p)=>{
  try{
    const res=await fetch(`https://api.github.com/repos/${r}/commits?path=${p}&per_page=1`);
    if(!res.ok)return{err:res.headers.get('x-ratelimit-remaining')==='0'?'Rate limited':'GitHub '+res.status};
    const d=new Date((await res.json())[0].commit.committer.date);
    return{date:d,txt:ago(Date.now()-d)};
  }catch{return{err:'Unavailable'}}
};

document.addEventListener('click',async e=>{
  const a=e.target.dataset.action;if(!a)return;
  ui(1,0,0);
  try{
    if(a==='verify'){
      const r=(await Promise.all(Object.values(files).map(
        f=>getGit(f.r,f.p).then(g=>({...g,l:f.l}))
      ))).sort((a,b)=>(b.date||0)-(a.date||0));
      info.innerHTML=r.map(c=>`‚Ä¢ <strong>${c.l}</strong>: ${c.txt||c.err}`).join('<br>');
      ui(0,0,1);
    }else{
      const f=files[a],[raw,git]=await Promise.all([
        fetch(f.u).then(r=>r.text()),getGit(f.r,f.p)
      ]);
      dl.href&&URL.revokeObjectURL(dl.href);
      dl.href=URL.createObjectURL(new Blob([decoders[a](raw)],{type:'application/xml'}));
      dl.download=f.n;dl.textContent=`Download ${f.n}`;
      info.innerHTML=`<strong>${f.l}</strong> updated: ${git.txt||git.err}`;
      ui(0,1,1);
    }
  }catch(err){
    info.textContent='üö® '+err.message;ui(0,0,1,1);
  }
});
</script>
</body>
</html>
